<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NETrieve ‚Äì IP Info</title>

  <!-- Styles -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>
  <div class="container">
    <h2>NETrieve üåê</h2>

    {% if ip_info and ip_info.get('Error') %}
      <div class="error-box">
        <strong>Error:</strong> {{ ip_info.get('Error') }}
      </div>
    {% else %}
      <table>
        {% for key, value in ip_info.items() %}
          <tr>
            <th>{{ key }}</th>
            <td>{{ value }}</td>
          </tr>
        {% endfor %}
      </table>

      {% set loc_value = ip_info.get('Location') if ip_info else '' %}
      {% if loc_value %}
        <div id="map"></div>
      {% else %}
        <p>No location coordinates available to show on the map.</p>
      {% endif %}

      <div class="center">
        <button id="refreshBtn">üîÑ Refresh Info</button>
      </div>
    {% endif %}
  </div>

  <script>
    // Refresh button
    const refreshBtn = document.getElementById('refreshBtn');
    if (refreshBtn) {
      refreshBtn.addEventListener('click', () => location.reload());
    }

    // Handle location map
    const loc = "{{ loc_value or '' }}";
    if (loc && loc.length) {
      const parts = loc.split(',').map(Number);
      if (parts.length === 2 && !isNaN(parts[0]) && !isNaN(parts[1])) {
        const map = L.map('map').setView([parts[0], parts[1]], 10);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="https://www.openstreetmap.org/">OSM</a> contributors'
        }).addTo(map);
        L.marker([parts[0], parts[1]]).addTo(map)
          .bindPopup("üìç Estimated location based on IP")
          .openPopup();
      }
    }
  </script>
</body>
</html>
